<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Health Care Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom right, #004e92, #000428);
            background-attachment: fixed;
            color: #fff;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .navbar {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            background-color: rgba(33, 37, 41, 0.9) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 0;
        }

        .navbar-brand {
            font-weight: 700;
            letter-spacing: 1px;
        }

        .nav-link {
            position: relative;
            margin: 0 5px;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: #0d6efd;
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .logo .myimg {
            max-height: 40px;
            margin-right: 10px;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
            transition: transform 0.3s ease;
        }

        .logo .myimg:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .form-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px;
            transform: translateY(0);
            transition: transform 0.5s ease, box-shadow 0.5s ease;
        }

        .form-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .form-control {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(13, 110, 253, 0.5);
            border-color: #0d6efd;
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .results-container {
            display: none;
            margin-top: 30px;
            margin-bottom: 50px;
            padding: 30px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .result-block {
            display: none; /* Initially hidden, will be shown by JavaScript */
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateY(0);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            opacity: 1; /* Ensure opacity is set to 1 */
            visibility: visible; /* Ensure visibility is set to visible */
        }

        .result-block:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
        }
        
        .result-block .list-group-item {
            transition: all 0.3s ease;
            margin-bottom: 5px;
            border-radius: 8px;
        }
        
        .result-block .list-group-item:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
            transform: translateX(5px);
        }

        .toggle-button {
            margin: 8px;
            padding: 12px 24px;
            border-radius: 30px;
            transition: all 0.3s ease;
            font-weight: 500;
            letter-spacing: 0.5px;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .toggle-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            box-shadow: 0 4px 15px rgba(255, 65, 108, 0.4);
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #ff4b2b, #ff416c);
            box-shadow: 0 6px 20px rgba(255, 65, 108, 0.6);
            transform: translateY(-2px);
        }

        h2 {
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Particle background effect */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <!-- Particle background effect -->
    <div class="particles" id="particles"></div>
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <div class="logo">
                <img class="myimg animate__animated animate__pulse animate__infinite animate__slow" src="{{ url_for('static', filename='img.png') }}" alt="Logo" aria-label="Health Center Logo">
            </div>
            <a class="navbar-brand" href="#">Health Center</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="#"><i class="fas fa-home me-1"></i> Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about"><i class="fas fa-info-circle me-1"></i> About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/contact"><i class="fas fa-envelope me-1"></i> Contact</a></li>
                    <li class="nav-item"><a class="nav-link" href="/developer"><i class="fas fa-code me-1"></i> Developer</a></li>
                    <li class="nav-item"><a class="nav-link" href="/blog"><i class="fas fa-blog me-1"></i> Blog</a></li>
                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>

    <div class="container my-5 animate__animated animate__fadeIn">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="text-center mb-5">
                    <h2 class="text-center text-white mb-4 animate__animated animate__fadeInDown">
                        <i class="fas fa-heartbeat me-2"></i> Predict Your Health
                    </h2>
                    <p class="text-light opacity-75 mb-4 animate__animated animate__fadeIn animate__delay-1s">
                        Our advanced AI system analyzes your symptoms and provides personalized health insights.
                    </p>
                </div>
                
                <div class="form-container animate__animated animate__fadeInUp animate__delay-1s">
                    <form id="predictForm" action="/predict" method="post">
                        <div class="form-group mb-4">
                            <label for="symptoms" class="mb-2"><i class="fas fa-notes-medical me-2"></i>Enter your symptoms:</label>
                            <div class="input-group">
                                <span class="input-group-text bg-transparent text-light border-end-0">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control border-start-0" id="symptoms" name="symptoms"
                                    placeholder="Type symptoms separated by commas (e.g., itching, fever, headache)">
                            </div>
                            <div class="form-text text-light mt-2 small">
                                <i class="fas fa-info-circle me-1"></i> Enter multiple symptoms separated by commas for more accurate results.
                            </div>
                            <div class="alert alert-info mt-3 small">
                                <i class="fas fa-lightbulb me-1"></i> <strong>Important:</strong> Use exact symptom names like "itching", "skin_rash", "joint_pain", etc. 
                                Click on the input field to see suggestions or use the "Show all valid symptoms" button to see the complete list.
                            </div>
                        </div>
                        <button type="submit" class="btn btn-danger btn-lg w-100 py-3 mt-2">
                            <i class="fas fa-stethoscope me-2"></i> Predict
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <section id="results" class="container results-container animate__animated animate__fadeIn">
        <div class="text-center mb-4">
            <h2 class="text-center text-info mb-3">
                <i class="fas fa-robot me-2"></i> Our AI System Results
            </h2>
            <p class="text-light opacity-75 mb-4">
                Review your personalized health analysis below
            </p>
        </div>
        
        <div class="d-flex flex-wrap justify-content-center mb-4">
            <button class="toggle-button btn btn-warning" data-target="disease" type="button">
                <i class="fas fa-virus me-2"></i> Disease
            </button>
            <button class="toggle-button btn btn-primary" data-target="description" type="button">
                <i class="fas fa-info-circle me-2"></i> Description
            </button>
            <button class="toggle-button btn btn-success" data-target="precaution" type="button">
                <i class="fas fa-shield-alt me-2"></i> Precaution
            </button>
            <button class="toggle-button btn btn-danger" data-target="medication" type="button">
                <i class="fas fa-pills me-2"></i> Medications
            </button>
            <button class="toggle-button btn btn-info" data-target="workouts" type="button">
                <i class="fas fa-running me-2"></i> Workouts
            </button>
            <button class="toggle-button btn btn-secondary" data-target="diets" type="button">
                <i class="fas fa-apple-alt me-2"></i> Diets
            </button>
        </div>

        <!-- Result blocks - initially hidden but will be shown by JavaScript -->
        <div id="disease" class="result-block">
            <h4><i class="fas fa-virus me-2"></i> Disease</h4>
            <p>{{ predicted_disease }}</p>
        </div>
        
        <div id="description" class="result-block">
            <h4><i class="fas fa-info-circle me-2"></i> Description</h4>
            <p>{{ description }}</p>
        </div>
        
        <div id="precaution" class="result-block">
            <h4><i class="fas fa-shield-alt me-2"></i> Precaution</h4>
            {% if precautions|length > 0 %}
                <ul class="list-group list-group-flush bg-transparent">
                    {% for item in precautions %}
                        {% if item %}
                            <li class="list-group-item bg-transparent text-light border-light">{{ item }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% else %}
                <p>No precautions available</p>
            {% endif %}
        </div>
        
        <div id="medication" class="result-block">
            <h4><i class="fas fa-pills me-2"></i> Medications</h4>
            {% if medications|length > 0 %}
                <ul class="list-group list-group-flush bg-transparent">
                    {% for item in medications %}
                        {% if item %}
                            <li class="list-group-item bg-transparent text-light border-light">{{ item }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% else %}
                <p>No medications available</p>
            {% endif %}
        </div>
        
        <div id="workouts" class="result-block">
            <h4><i class="fas fa-running me-2"></i> Workouts</h4>
            {% if workouts|length > 0 %}
                <ul class="list-group list-group-flush bg-transparent">
                    {% for item in workouts %}
                        {% if item %}
                            <li class="list-group-item bg-transparent text-light border-light">{{ item }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% else %}
                <p>No workouts available</p>
            {% endif %}
        </div>
        
        <div id="diets" class="result-block">
            <h4><i class="fas fa-apple-alt me-2"></i> Diets</h4>
            {% if diets|length > 0 %}
                <ul class="list-group list-group-flush bg-transparent">
                    {% for item in diets %}
                        {% if item %}
                            <li class="list-group-item bg-transparent text-light border-light">{{ item }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% else %}
                <p>No diets available</p>
            {% endif %}
        </div>
    </section>

    <script>
        // Debug function to log the state of result blocks
        function logResultBlocksState() {
            const blocks = document.querySelectorAll('.result-block');
            console.log('Result blocks state:');
            blocks.forEach(block => {
                console.log(`Block ${block.id}: display=${block.style.display}, visibility=${getComputedStyle(block).visibility}, opacity=${getComputedStyle(block).opacity}`);
            });
        }
        
        const form = document.getElementById('predictForm');
        const resultsSection = document.getElementById('results');
        const toggleButtons = document.querySelectorAll('.toggle-button');
        const resultBlocks = document.querySelectorAll('.result-block');
        
        // Log initial state
        console.log('Initial DOM loaded, result blocks count:', resultBlocks.length);
        logResultBlocksState();

        // Create particle effect
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // Random size between 2px and 6px
                const size = Math.random() * 4 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random position
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.top = `${Math.random() * 100}vh`;
                
                // Random animation duration between 15s and 30s
                const duration = Math.random() * 15 + 15;
                particle.style.animationDuration = `${duration}s`;
                
                // Random delay
                const delay = Math.random() * 5;
                particle.style.animationDelay = `${delay}s`;
                
                // Random opacity
                particle.style.opacity = Math.random() * 0.5 + 0.1;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Initialize particles
        createParticles();
        
        // Initialize results section
        if (resultsSection) {
            // Always make the results section visible initially
            resultsSection.style.display = 'block';
            
            // Show first result by default
            if (resultBlocks.length > 0) {
                console.log('Initializing result blocks:', resultBlocks.length);
                
                // First make sure all blocks are properly initialized
                resultBlocks.forEach(block => {
                    // Ensure the block is in the DOM but hidden initially
                    block.style.display = 'none';
                    block.classList.remove('d-none');
                    // Remove any animation classes that might interfere
                    block.classList.remove('animate__fadeIn');
                });
                
                // Show the first block with a slight delay to ensure DOM is ready
                setTimeout(() => {
                    resultBlocks[0].style.display = 'block';
                    // Force a reflow to ensure the display change takes effect
                    void resultBlocks[0].offsetHeight;
                    resultBlocks[0].classList.add('animate__fadeIn');
                    
                    // Update button states
                    toggleButtons.forEach(btn => btn.classList.remove('active'));
                    toggleButtons[0].classList.add('active');
                    
                    console.log('First result block displayed:', resultBlocks[0].id);
                }, 50);
            }
        }
        
        // Common symptoms for autocomplete suggestions
        const commonSymptoms = [
            'itching', 'skin_rash', 'nodal_skin_eruptions', 'continuous_sneezing', 'shivering', 
            'chills', 'joint_pain', 'stomach_pain', 'acidity', 'ulcers_on_tongue', 'muscle_wasting', 
            'vomiting', 'burning_micturition', 'spotting_urination', 'fatigue', 'weight_gain', 
            'anxiety', 'cold_hands_and_feets', 'mood_swings', 'weight_loss', 'restlessness', 
            'lethargy', 'patches_in_throat', 'irregular_sugar_level', 'cough', 'high_fever', 
            'sunken_eyes', 'breathlessness', 'sweating', 'dehydration', 'indigestion', 'headache', 
            'yellowish_skin', 'dark_urine', 'nausea', 'loss_of_appetite', 'pain_behind_the_eyes', 
            'back_pain', 'constipation', 'abdominal_pain', 'diarrhoea', 'mild_fever', 'yellow_urine', 
            'yellowing_of_eyes', 'acute_liver_failure', 'swelling_of_stomach', 'swelled_lymph_nodes', 
            'malaise', 'blurred_and_distorted_vision', 'phlegm', 'throat_irritation', 'redness_of_eyes', 
            'sinus_pressure', 'runny_nose', 'congestion', 'chest_pain', 'weakness_in_limbs', 
            'fast_heart_rate', 'pain_during_bowel_movements', 'pain_in_anal_region', 'bloody_stool', 
            'irritation_in_anus', 'neck_pain', 'dizziness', 'cramps', 'bruising', 'obesity', 
            'swollen_legs', 'swollen_blood_vessels', 'puffy_face_and_eyes', 'enlarged_thyroid', 
            'brittle_nails', 'swollen_extremeties', 'excessive_hunger', 'drying_and_tingling_lips', 
            'slurred_speech', 'knee_pain', 'hip_joint_pain', 'muscle_weakness', 'stiff_neck', 
            'swelling_joints', 'movement_stiffness', 'spinning_movements', 'loss_of_balance', 
            'unsteadiness', 'weakness_of_one_body_side', 'loss_of_smell', 'bladder_discomfort', 
            'foul_smell_of_urine', 'continuous_feel_of_urine', 'passage_of_gases', 'internal_itching', 
            'depression', 'irritability', 'muscle_pain', 'altered_sensorium', 'red_spots_over_body', 
            'belly_pain', 'abnormal_menstruation', 'watering_from_eyes', 'increased_appetite', 
            'polyuria', 'family_history', 'mucoid_sputum', 'rusty_sputum', 'lack_of_concentration', 
            'visual_disturbances', 'receiving_blood_transfusion', 'receiving_unsterile_injections', 
            'coma', 'stomach_bleeding', 'distention_of_abdomen', 'history_of_alcohol_consumption', 
            'blood_in_sputum', 'prominent_veins_on_calf', 'palpitations', 'painful_walking', 
            'pus_filled_pimples', 'blackheads', 'scurring', 'skin_peeling', 'silver_like_dusting', 
            'small_dents_in_nails', 'inflammatory_nails', 'blister', 'red_sore_around_nose', 
            'yellow_crust_ooze'
        ];
        
        // Add symptom suggestions when input is focused
        const symptomsInput = document.getElementById('symptoms');
        symptomsInput.addEventListener('focus', function() {
            // Show a random selection of 5 common symptoms as a suggestion
            const randomSymptoms = commonSymptoms
                .sort(() => 0.5 - Math.random())
                .slice(0, 5)
                .join(', ');
                
            const suggestionDiv = document.createElement('div');
            suggestionDiv.className = 'symptom-suggestions form-text text-info mt-1 small';
            suggestionDiv.innerHTML = `
                <i class="fas fa-lightbulb me-1"></i> Try: ${randomSymptoms}
                <button type="button" id="showAllSymptoms" class="btn btn-sm btn-outline-info mt-2">
                    <i class="fas fa-list me-1"></i> Show all valid symptoms
                </button>
            `;
            
            // Remove any existing suggestions
            const existingSuggestions = document.querySelector('.symptom-suggestions');
            if (existingSuggestions) {
                existingSuggestions.remove();
            }
            
            // Add the new suggestions
            this.parentNode.appendChild(suggestionDiv);
            
            // Add event listener to the "Show all symptoms" button
            document.getElementById('showAllSymptoms').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Create a modal to display all symptoms
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = 'symptomsModal';
                modal.setAttribute('tabindex', '-1');
                modal.setAttribute('aria-labelledby', 'symptomsModalLabel');
                modal.setAttribute('aria-hidden', 'true');
                
                // Group symptoms alphabetically
                const groupedSymptoms = {};
                commonSymptoms.forEach(symptom => {
                    const firstLetter = symptom[0].toUpperCase();
                    if (!groupedSymptoms[firstLetter]) {
                        groupedSymptoms[firstLetter] = [];
                    }
                    groupedSymptoms[firstLetter].push(symptom);
                });
                
                // Create the modal content with grouped symptoms
                let symptomsHtml = '';
                Object.keys(groupedSymptoms).sort().forEach(letter => {
                    symptomsHtml += `<h5 class="mt-3">${letter}</h5><div class="row">`;
                    groupedSymptoms[letter].sort().forEach(symptom => {
                        symptomsHtml += `
                            <div class="col-md-4 mb-2">
                                <button class="btn btn-sm btn-outline-light w-100 text-start symptom-btn" 
                                        data-symptom="${symptom}">
                                    ${symptom.replace(/_/g, ' ')}
                                </button>
                            </div>
                        `;
                    });
                    symptomsHtml += '</div>';
                });
                
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg modal-dialog-scrollable">
                        <div class="modal-content bg-dark text-light">
                            <div class="modal-header">
                                <h5 class="modal-title" id="symptomsModalLabel">
                                    <i class="fas fa-list-ul me-2"></i> All Valid Symptoms
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>Click on symptoms to add them to your input. Separate multiple symptoms with commas.</p>
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control bg-dark text-light" placeholder="Search symptoms..." id="symptomSearch">
                                    <button class="btn btn-outline-light" type="button" id="clearSearch">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div id="symptomsContainer">
                                    ${symptomsHtml}
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add the modal to the document
                document.body.appendChild(modal);
                
                // Initialize the Bootstrap modal
                const modalInstance = new bootstrap.Modal(document.getElementById('symptomsModal'));
                modalInstance.show();
                
                // Add event listeners to symptom buttons
                document.querySelectorAll('.symptom-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const symptom = this.getAttribute('data-symptom');
                        const currentValue = symptomsInput.value.trim();
                        
                        if (currentValue === '') {
                            symptomsInput.value = symptom;
                        } else {
                            // Check if the symptom is already in the input
                            const symptoms = currentValue.split(',').map(s => s.trim());
                            if (!symptoms.includes(symptom)) {
                                symptomsInput.value = currentValue + ', ' + symptom;
                            }
                        }
                    });
                });
                
                // Add search functionality
                const searchInput = document.getElementById('symptomSearch');
                const clearSearch = document.getElementById('clearSearch');
                
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    document.querySelectorAll('.symptom-btn').forEach(btn => {
                        const symptom = btn.getAttribute('data-symptom');
                        const parent = btn.parentElement;
                        
                        if (symptom.includes(searchTerm) || symptom.replace(/_/g, ' ').includes(searchTerm)) {
                            parent.style.display = 'block';
                        } else {
                            parent.style.display = 'none';
                        }
                    });
                });
                
                clearSearch.addEventListener('click', function() {
                    searchInput.value = '';
                    document.querySelectorAll('.symptom-btn').forEach(btn => {
                        btn.parentElement.style.display = 'block';
                    });
                });
            });
        });

        // Form submission with animation
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            submitBtn.disabled = true;
            
            // Get form data
            const formData = new FormData(this);
            
            // Submit form using fetch API with proper headers
            fetch('/predict', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                    // Do not set Content-Type header when using FormData, browser will set it automatically with boundary
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Update the disease block
                const diseaseBlock = document.querySelector('#disease');
                if (diseaseBlock) {
                    diseaseBlock.innerHTML = `
                        <h4><i class="fas fa-virus me-2"></i> Disease</h4>
                        <p>${data.predicted_disease || 'No disease predicted'}</p>
                    `;
                }
                
                // Update the description block
                const descriptionBlock = document.querySelector('#description');
                if (descriptionBlock) {
                    descriptionBlock.innerHTML = `
                        <h4><i class="fas fa-info-circle me-2"></i> Description</h4>
                        <p>${data.description || 'No description available'}</p>
                    `;
                }
                
                // Update the precaution block
                const precautionBlock = document.querySelector('#precaution');
                if (precautionBlock) {
                    if (data.precautions && data.precautions.length > 0) {
                        let precautionHTML = `<h4><i class="fas fa-shield-alt me-2"></i> Precaution</h4>
                            <ul class="list-group list-group-flush bg-transparent">`;
                        
                        data.precautions.forEach(item => {
                            if (item && item.toLowerCase() !== 'nan') {
                                precautionHTML += `<li class="list-group-item bg-transparent text-light border-light">${item}</li>`;
                            }
                        });
                        
                        precautionHTML += `</ul>`;
                        precautionBlock.innerHTML = precautionHTML;
                    } else {
                        precautionBlock.innerHTML = `
                            <h4><i class="fas fa-shield-alt me-2"></i> Precaution</h4>
                            <p>No precautions available</p>
                        `;
                    }
                }
                
                // Update the medication block
                const medicationBlock = document.querySelector('#medication');
                if (medicationBlock) {
                    if (data.medications && data.medications.length > 0) {
                        let medicationHTML = `<h4><i class="fas fa-pills me-2"></i> Medications</h4>
                            <ul class="list-group list-group-flush bg-transparent">`;
                        
                        data.medications.forEach(item => {
                            if (item && item.toLowerCase() !== 'nan') {
                                medicationHTML += `<li class="list-group-item bg-transparent text-light border-light">${item}</li>`;
                            }
                        });
                        
                        medicationHTML += `</ul>`;
                        medicationBlock.innerHTML = medicationHTML;
                    } else {
                        medicationBlock.innerHTML = `
                            <h4><i class="fas fa-pills me-2"></i> Medications</h4>
                            <p>No medications available</p>
                        `;
                    }
                }
                
                // Update the workouts block
                const workoutsBlock = document.querySelector('#workouts');
                if (workoutsBlock) {
                    if (data.workouts && data.workouts.length > 0) {
                        let workoutsHTML = `<h4><i class="fas fa-running me-2"></i> Workouts</h4>
                            <ul class="list-group list-group-flush bg-transparent">`;
                        
                        data.workouts.forEach(item => {
                            if (item && item.toLowerCase() !== 'nan') {
                                workoutsHTML += `<li class="list-group-item bg-transparent text-light border-light">${item}</li>`;
                            }
                        });
                        
                        workoutsHTML += `</ul>`;
                        workoutsBlock.innerHTML = workoutsHTML;
                    } else {
                        workoutsBlock.innerHTML = `
                            <h4><i class="fas fa-running me-2"></i> Workouts</h4>
                            <p>No workouts available</p>
                        `;
                    }
                }
                
                // Update the diets block
                const dietsBlock = document.querySelector('#diets');
                if (dietsBlock) {
                    if (data.diets && data.diets.length > 0) {
                        let dietsHTML = `<h4><i class="fas fa-apple-alt me-2"></i> Diets</h4>
                            <ul class="list-group list-group-flush bg-transparent">`;
                        
                        data.diets.forEach(item => {
                            if (item && item.toLowerCase() !== 'nan') {
                                dietsHTML += `<li class="list-group-item bg-transparent text-light border-light">${item}</li>`;
                            }
                        });
                        
                        dietsHTML += `</ul>`;
                        dietsBlock.innerHTML = dietsHTML;
                    } else {
                        dietsBlock.innerHTML = `
                            <h4><i class="fas fa-apple-alt me-2"></i> Diets</h4>
                            <p>No diets available</p>
                        `;
                    }
                }
                
                // Check if we have a correction message to display
                if (data.message && data.message.includes("automatically corrected")) {
                    // Create a correction notification
                    const correctionMessage = document.createElement('div');
                    correctionMessage.className = 'alert alert-info mt-3 animate__animated animate__fadeIn';
                    correctionMessage.innerHTML = `
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> ${data.message}
                    `;
                    
                    // Clear any previous messages
                    const previousMessages = form.querySelectorAll('.alert');
                    previousMessages.forEach(msg => msg.remove());
                    
                    // Add the message to the form
                    form.appendChild(correctionMessage);
                    
                    // Remove the message after 10 seconds
                    setTimeout(() => {
                        correctionMessage.classList.add('animate__fadeOut');
                        setTimeout(() => {
                            correctionMessage.remove();
                        }, 500);
                    }, 10000);
                }
                
                // Always show results section
                resultsSection.style.display = 'block';
                resultsSection.classList.remove('animate__fadeIn');
                void resultsSection.offsetWidth; // Trigger reflow to restart animation
                resultsSection.classList.add('animate__fadeIn');
                
                // Scroll to results with smooth animation
                setTimeout(() => {
                    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
                
                // Show first result by default and make all blocks visible
                // We need to re-query the DOM for result blocks as they may have been updated
                const updatedResultBlocks = document.querySelectorAll('.result-block');
                console.log('Initializing result blocks after AJAX:', updatedResultBlocks.length);
                logResultBlocksState();
                
                // First make sure all blocks are properly initialized
                updatedResultBlocks.forEach(block => {
                    // Remove any animation classes
                    block.classList.remove('animate__fadeIn');
                    // Hide all blocks initially
                    block.style.display = 'none';
                    // Ensure the block is in the DOM
                    block.classList.remove('d-none');
                });
                
                // Show the first block with a slight delay to ensure DOM is ready
                setTimeout(() => {
                    // Show the first block
                    if (updatedResultBlocks.length > 0) {
                        updatedResultBlocks[0].style.display = 'block';
                        // Force a reflow to ensure the display change takes effect
                        void updatedResultBlocks[0].offsetHeight;
                        // Add animation class
                        updatedResultBlocks[0].classList.add('animate__fadeIn');
                        
                        // Update button states
                        toggleButtons.forEach(btn => btn.classList.remove('active'));
                        toggleButtons[0].classList.add('active');
                        
                        console.log('First result block displayed after AJAX:', updatedResultBlocks[0].id);
                        logResultBlocksState();
                        
                        // Set up toggle buttons again to ensure they work with the updated DOM
                        setupToggleButtons();
                    }
                }, 100);
                
                // Reset button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                // Make sure toggle buttons work
                setupToggleButtons();
                
                if (updatedResultBlocks.length > 0) {
                    // First make sure all blocks are properly initialized
                    updatedResultBlocks.forEach(block => {
                        // Remove any animation classes
                        block.classList.remove('animate__fadeIn');
                        // Hide all blocks initially
                        block.style.display = 'none';
                        // Ensure the block is in the DOM
                        block.classList.remove('d-none');
                    });
                    
                    // Show the first block with a slight delay to ensure DOM is ready
                    setTimeout(() => {
                        // Show the first block
                        updatedResultBlocks[0].style.display = 'block';
                        // Force a reflow to ensure the display change takes effect
                        void updatedResultBlocks[0].offsetHeight;
                        // Add animation class
                        updatedResultBlocks[0].classList.add('animate__fadeIn');
                        
                        // Update button states
                        toggleButtons.forEach(btn => btn.classList.remove('active'));
                        toggleButtons[0].classList.add('active');
                        
                        console.log('First result block displayed after AJAX:', updatedResultBlocks[0].id);
                        logResultBlocksState();
                        
                        // Set up toggle buttons again to ensure they work with the updated DOM
                        setupToggleButtons();
                    }, 100);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                // Hide results section for network errors
                resultsSection.style.display = 'none';
                
                // Create a more user-friendly error message
                const errorMessage = document.createElement('div');
                errorMessage.className = 'alert alert-danger mt-3 animate__animated animate__fadeIn';
                errorMessage.innerHTML = `
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Connection Error:</strong> Unable to process your request. 
                    <p class="mt-2 mb-0">Please check your internet connection and try again, or try with different symptoms.</p>
                    <p class="mt-2 mb-0 small">Make sure to use symptoms from the suggested list and separate them with commas.</p>
                `;
                
                // Clear any previous error messages
                const previousErrors = form.querySelectorAll('.alert');
                previousErrors.forEach(err => err.remove());
                
                // Add the error message to the form
                form.appendChild(errorMessage);
                
                // Remove the error message after 10 seconds
                setTimeout(() => {
                    errorMessage.classList.add('animate__fadeOut');
                    setTimeout(() => {
                        errorMessage.remove();
                    }, 500);
                }, 10000);
            });
        });

        // Function to set up toggle button event listeners
        function setupToggleButtons() {
            // Get the latest set of toggle buttons
            const currentToggleButtons = document.querySelectorAll('.toggle-button');
            
            currentToggleButtons.forEach(button => {
                // Remove any existing event listeners by cloning and replacing the button
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                
                // Add the click event listener to the new button
                newButton.addEventListener('click', function () {
                    console.log('Toggle button clicked:', this.getAttribute('data-target'));
                    
                    // Remove active class from all buttons
                    document.querySelectorAll('.toggle-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    const targetId = this.getAttribute('data-target');
                    console.log('Toggle button clicked for:', targetId);
                    
                    // Get the latest set of result blocks
                    const currentResultBlocks = document.querySelectorAll('.result-block');
                    
                    // First, remove animation classes from all blocks and hide them
                    currentResultBlocks.forEach(block => {
                        block.classList.remove('animate__fadeIn');
                        if (block.id !== targetId) {
                            block.style.display = 'none';
                        }
                    });
                    
                    // Show target block with animation
                    const targetBlock = document.getElementById(targetId);
                    if (targetBlock) {
                        console.log('Showing target block:', targetId);
                        
                        // Make sure the block is visible
                        targetBlock.style.display = 'block';
                        
                        // Force a reflow to ensure the display change takes effect
                        void targetBlock.offsetHeight;
                        
                        // Add animation class after a small delay
                        setTimeout(() => {
                            targetBlock.classList.add('animate__fadeIn');
                        }, 10);
                        
                        // Log the state for debugging
                        logResultBlocksState();
                    } else {
                        console.error(`Element with ID "${targetId}" not found`);
                    }
                });
            });
            
            console.log('Toggle buttons set up:', currentToggleButtons.length);
        }
        
        // Set up toggle buttons initially
        setupToggleButtons();

        // Add typing effect to symptoms input
        const placeholderText = symptomsInput.getAttribute('placeholder');
        symptomsInput.setAttribute('placeholder', '');
        
        let charIndex = 0;
        function typeEffect() {
            if (charIndex < placeholderText.length) {
                symptomsInput.setAttribute('placeholder', placeholderText.substring(0, charIndex + 1));
                charIndex++;
                setTimeout(typeEffect, 50);
            }
        }
        
        // Start typing effect after page load
        setTimeout(typeEffect, 1000);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
</body>

</html>
